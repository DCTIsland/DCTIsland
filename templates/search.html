<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>緒島</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- <link rel="stylesheet" href='static/styles.css'> -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Nova+Mono&display=swap" rel="stylesheet"> -->
    <!-- 添加 SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        .swal2-popup {
            font-family: "Microsoft JhengHei", sans-serif;
            border-radius: 30px;
            background-color: #FDF6EC;
            border: 4px solid #E19D2D;
            margin: 15px;
            padding: 15px;
            width: 85% !important;
            max-width: 350px !important;
        }

        .swal2-title {
            color: #4A4A4A;
            font-size: 1.3em;
            margin-bottom: 5px;
        }

        .swal2-html-container {
            color: #666666;
            margin: 5px 0;
            font-size: 0.95em;
        }

        .swal2-confirm {
            border: none !important;
            background-color: #F2B137 !important;
            min-width: 120px;
            border-radius: 25px !important;
            font-size: 1em !important;
            padding: 10px 30px !important;
            margin: 0 8px !important;
        }

        .swal2-confirm:hover {
            background-color: #E19D2D !important;
        }
    </style>
</head>
<body>
    <!-- 上方綠色區塊 -->
    <div class="header"></div>
    
    <!-- 主要內容容器 -->
    <div class="container">

        <h1>STEP 2</h1>
        <p>輸入您曾登島的ID。</p>

        <div class="form-container">
            <form class="form" id="threadsForm" onsubmit="handleSubmit(event)">
                <div class="input-container">
                    <label for="thread_id" style="display: flex; align-items: center;"><img src="static/search.png" alt="search" style="height: 1.2em; width: auto; display: inline-block; vertical-align: middle;"></label>
                    <input type="text" id="thread_id" name="thread_id" placeholder="" required>
                </div>
                <button type="submit" class="submit-btn">尋找我的島嶼</button>
            </form>
            <a href="/mode" class="no-threads-account" style="-webkit-tap-highlight-color: transparent; text-underline-offset: 1px;" onmouseover="this.style.color='#999'" onmouseout="this.style.color='inherit'">返回選擇其他模式 &gt;</a>
        </div>
    </div>

    <div class="footer"></div> <!-- 單條綠色區塊 -->
        <div class="footer-character">
                <img src="static/Threadman.png" alt="Threadman">
        </div>        
    </div>

    <script>
        // 控制按鈕啟用與否
        const input = document.getElementById('thread_id');
        const button = document.querySelector('.submit-btn');

        input.addEventListener('input', () => {
            if (input.value.trim()) {
                button.disabled = false;
                button.classList.add('active');
            } else {
                button.disabled = true;
                button.classList.remove('active');
            }
        });

        // 處理表單提交
        async function handleSubmit(event) {
            event.preventDefault();
            const threadId = input.value.trim();
            
            try {
                const response = await fetch('/search_submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ 'thread_id': threadId })
                });

                if (response.ok) {
                    // If the response is OK, it means we found the data and got HTML
                    const html = await response.text();
                    document.open();
                    document.write(html);
                    document.close();
                } else if (response.status === 404) {
                    // If we get a 404, show the "not found" message
                    Swal.fire({
                        title: 'Oops！',
                        text: '查無此資料，請先建立島嶼！',
                        icon: 'warning',
                        confirmButtonText: '好的',
                        confirmButtonColor: '#F2B137',
                        background: '#FDF6EC',
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        customClass: {
                            popup: 'swal2-popup',
                            title: 'swal2-title',
                            htmlContainer: 'swal2-html-container',
                            confirmButton: 'swal2-confirm'
                        },
                        buttonsStyling: true
                    });
                } else {
                    // For other errors
                    Swal.fire({
                        title: '錯誤',
                        text: '搜尋過程中發生錯誤，請稍後再試',
                        icon: 'error',
                        confirmButtonText: '好的',
                        confirmButtonColor: '#F2B137',
                        background: '#FDF6EC',
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        customClass: {
                            popup: 'swal2-popup',
                            title: 'swal2-title',
                            htmlContainer: 'swal2-html-container',
                            confirmButton: 'swal2-confirm'
                        },
                        buttonsStyling: true
                    });
                }
            } catch (error) {
                console.error('Error:', error);
                Swal.fire({
                    title: '發生錯誤',
                    text: '請稍後再試',
                    icon: 'error',
                    confirmButtonText: '好的',
                    confirmButtonColor: '#F2B137',
                    background: '#FDF6EC',
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    customClass: {
                        popup: 'swal2-popup',
                        title: 'swal2-title',
                        htmlContainer: 'swal2-html-container',
                        confirmButton: 'swal2-confirm'
                    },
                    buttonsStyling: true
                });
            }
        }
    </script>
    <script>
        function isSafari() {
            return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        }
    
        function isLineBrowser() {
            return /Line/i.test(navigator.userAgent);
        }
    
        function adjustCharacter() {
            const footerCharacter = document.querySelector('.footer-character');
            if (!footerCharacter) return;
    
            const footerHeight = document.querySelector('.footer')?.offsetHeight || 50;
    
            if (isLineBrowser()) {
                // 如果是 LINE 瀏覽器，隱藏 footer-character
                footerCharacter.style.display = 'none';
            } else {
                // Safari 顯示，並且推高
                footerCharacter.style.display = 'block';
                if (isSafari()) {
                    footerCharacter.style.bottom = `${footerHeight + 10}px`;
                } else {
                    footerCharacter.style.bottom = `${footerHeight}px`;
                }
            }
        }
    
        window.addEventListener('load', adjustCharacter);
        window.addEventListener('resize', adjustCharacter);
    </script>    
</body>
</html>
